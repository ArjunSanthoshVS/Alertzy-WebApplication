<div class="background pb-3" style="    margin-left: 13%;
    width: 85%;">
  <div class="" style=" vh-100">

    <a class="navbar-brand mt-4" style="font-family: none; font-weight: 900; color: black;">
      <h1 class="text-center pt-5">Products</h1>
    </a>
    <div class="add d-flex justify-content-end">
      <a href="/admin/add-product" class="btn btn-primary ms-auto">Add Product</a>
    </div>

    {{!--------------------------------------------------------------------------}}


    {{!-- <div class="add d-flex justify-content-end">
      <button type="button" class="btn btn-primary d-flex justify-content-end" data-bs-toggle="modal"
        data-bs-target="#cropperModal" data-bs-whatever=" @mdo">Add Product</button>
    </div>

    <div class="modal fade" id="cropperModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Add new Product</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form action="/admin/add-productSample" method="post" enctype="multipart/form-data">
              <div class="container m-5">
                <div class="row">
                  <div class="col-md-8">
                    <div class="row mb-3 mt-4">
                      <label for="" class="col-form-label">Product</label>
                      <div>
                        <input type="text" class="form-control" id="inputEmail3" name="product" required>
                      </div>
                    </div>
                    <div class="row mb-3 mt-4">
                      <label for="" class="col-form-label">Brand</label>
                      <div>
                        <input type="text" class="form-control" id="inputEmail3" name="brand" required>
                      </div>
                    </div>

                    <div class="row mb-3 mt-4">
                      <label for="" class="col-form-label">Stock</label>
                      <div>
                        <input type="number" class="form-control" id="inputEmail3" name="stock" required>
                      </div>
                    </div>
                    <div class="row mb-3 mt-4">
                      <label for="" class="col-form-label">Actual Price</label>
                      <div>
                        <input type="number" class="form-control" name="actualprice" required>
                      </div>
                    </div>
                    <div class="row mb-3 mt-4  ">
                      <label for="" class="col-form-label">Offer Price</label>
                      <div>
                        <input type="number" class="form-control" name="offerprice" required>
                      </div>
                    </div>
                    <div class="row mb-3 mt-4">
                      <label for="" class="col-form-label">Category</label>
                      <div>
                        <select id="inputState" class="form-select" name="category" required>
                          <option selected>Choose the Category...</option>
                          {{#each category}}
                          <option>{{this.category}}</option>
                          {{/each}}
                        </select>
                      </div>
                    </div>
                    <input type="file" name="image" id="file" accept="image/*" multiple />
                  </div>
                </div>
              </div>

              <input type="hidden" id="post_img_data" name="image_data_url">
              <div class="modal-body p-4">
                <div class="img-preview"></div>
                <div id="galleryImages"></div>
                <div id="cropper">
                  <canvas id="cropperImg" width="0" height="0"></canvas>
                  <button type="button" class="cropImageBtn btn btn-danger" style="display:none;"
                    id="cropImageBtn">Crop</button>
                </div>
                <div id="imageValidate" class="text-danger"></div>
              </div>
              <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </form>
          </div>
          {{!-- <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Send message</button>
          </div> --}}
        </div>
      </div>
    </div> --}}

    {{!--.....................................................................................---}}

    <div class="d-flex justify-content-center" style="margin-left:9%;">
      {{!-- <form class="d-flex">
        <input class="form-control me-1" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-primary" type="submit">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
      </form> --}}

      <div class="row mb-3 ms-3">

        <table id="example" class="table table-hover table-bordered ms-3" style="width:100%">
          <thead>
            <tr>
              <th scope="col">No</th>
              <th scope="col">Product</th>
              <th scope="col">Brand</th>
              <th scope="col">Stock</th>
              <th scope="col">Actual Price</th>
              <th scope="col">Offer Price</th>
              <th scope="col">Category</th>
              <th scope="col">Image</th>
              <th scope="col">Edit</th>
              <th scope="col">Delete</th>
            </tr>
          </thead>
          <tbody>
            {{#each products}}
            <tr>
              <th scope="row">{{inc @index}}</th>
              <td class="align-middle fw-b">{{this.product}}</td>
              <td class="align-middle fw-b">{{this.brand}}</td>
              <td class="align-middle fw-b">{{this.stock}}</td>
              <td class="align-middle fw-b">{{this.actualPrice}}</td>
              <td class="align-middle fw-b">{{this.offerPrice}}</td>
              <td class="align-middle fw-b">{{this.category}}</td>
              <td><img style="width:100px; height:100px;" src="/product-images/{{this._id}}/{{this._id}}_0.png" alt="">
              </td>
              <td class="align-middle fw-b"><a href="/admin/edit-product/{{this._id}}"><i
                    class="fa-solid fa-pen-to-square d-flex justify-content-center" style="font-size:20px;"></i></a>
              </td>
              <td class="align-middle fw-b"><a href="/admin/delete-product/{{this._id}}"
                  onclick="return confirm('Are you want to delete {{this.product}}')"><i
                    class="fa-solid fa-trash d-flex justify-content-center" style="font-size:20px; color: red;"></i></a>
              </td>

            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>



<script>
  $(document).ready(function () {
    $('#example').DataTable();
  });
</script>
{{!--

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.5/cropper.min.js"
  integrity="sha512-E4KfIuQAc9ZX6zW1IUJROqxrBqJXPuEcDKP6XesMdu2OV4LW7pj8+gkkyx2y646xEV7yxocPbaTtk2LQIJewXw=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.5/cropper.min.css"
  integrity="sha512-Aix44jXZerxlqPbbSLJ03lEsUch9H/CmnNfWxShD6vJBbboR+rPdDXmKN+/QjISWT80D4wMjtM4Kx7+xkLVywQ=="
  crossorigin="anonymous" referrerpolicy="no-referrer" />
<script>
  $(document).ready(function () {
    $("body").on("change", "#file", function (e) {
      $('.singleImageCanvasContainer').remove();
      $('#post_img_data').val('');
    });
  })
</script>
<script>

  //Multiple image cropper and preview on creating post
  var c;
  var galleryImagesContainer = document.getElementById('galleryImages');
  var imageCropFileInput = document.getElementById('file');
  var cropperImageInitCanvas = document.getElementById('cropperImg');
  var cropImageButton = document.getElementById('cropImageBtn');
  // Crop Function On change
  function imagesPreview(input) {
    var cropper;
    //cropImageButton.className = 'show';
    var img = [];
    if (input.files.length) {
      var i = 0;
      var index = 0;
      for (let singleFile of input.files) {
        var reader = new FileReader();
        reader.onload = function (event) {
          var blobUrl = event.target.result;
          img.push(new Image());
          img[i].onload = function (e) {
            // Canvas Container
            var singleCanvasImageContainer = document.createElement('div');
            singleCanvasImageContainer.id = 'singleImageCanvasContainer' + index;
            singleCanvasImageContainer.className = 'singleImageCanvasContainer';
            // Canvas Close Btn
            var singleCanvasImageCloseBtn = document.createElement('button');
            var singleCanvasImageCloseBtnText = document.createTextNode('X');
            // var singleCanvasImageCloseBtnText = document.createElement('i');
            // singleCanvasImageCloseBtnText.className = 'fa fa-times';
            singleCanvasImageCloseBtn.id = 'singleImageCanvasCloseBtn' + index;
            singleCanvasImageCloseBtn.className = 'singleImageCanvasCloseBtn';
            singleCanvasImageCloseBtn.classList.add("btn", "btn-sm");
            singleCanvasImageCloseBtn.onclick = function () {
              removeSingleCanvas(this)
            };
            singleCanvasImageCloseBtn.appendChild(singleCanvasImageCloseBtnText);
            singleCanvasImageContainer.appendChild(singleCanvasImageCloseBtn);
            // Image Canvas
            var canvas = document.createElement('canvas');
            canvas.id = 'imageCanvas' + index;
            canvas.className = 'imageCanvas singleImageCanvas';
            canvas.width = e.currentTarget.width;
            canvas.height = e.currentTarget.height;
            canvas.onclick = function () { cropInit(canvas.id); };
            singleCanvasImageContainer.appendChild(canvas)
            // Canvas Context
            var ctx = canvas.getContext('2d');
            ctx.drawImage(e.currentTarget, 0, 0);
            // galleryImagesContainer.append(canvas);
            galleryImagesContainer.appendChild(singleCanvasImageContainer);
            // while (document.querySelectorAll('.singleImageCanvas').length == input.files.length) {
            //     var allCanvasImages = document.querySelectorAll('.singleImageCanvas')[0].getAttribute('id');
            //     console.log(allCanvasImages);
            //     //commented by sam
            //     //cropInit(allCanvasImages);
            //     break;
            // };
            urlConversion();
            index++;
          };
          img[i].src = blobUrl;
          i++;
        }
        reader.readAsDataURL(singleFile);
      }
    }
  }
  imageCropFileInput.addEventListener("change", function (event) {

    $('#cropperModal').modal('show');
    var mediaValidation = validatePostMedia(event.target.files);
    if (!mediaValidation) {
      var $el = $('#file');
      $el.wrap('<form>').closest('form').get(0).reset();
      $el.unwrap();
      return false;
    }

    $('#mediaPreview').empty();
    $('.singleImageCanvasContainer').remove();
    if (cropperImageInitCanvas.cropper) {
      cropperImageInitCanvas.cropper.destroy();
      cropperImageInitCanvas.width = 0;
      cropperImageInitCanvas.height = 0;
      cropImageButton.style.display = 'none';
    }
    imagesPreview(event.target);
  });// Initialize Cropper
  function cropInit(selector) {
    c = document.getElementById(selector);

    if (cropperImageInitCanvas.cropper) {
      cropperImageInitCanvas.cropper.destroy();
    }
    var allCloseButtons = document.querySelectorAll('.singleImageCanvasCloseBtn');
    for (let element of allCloseButtons) {
      element.style.display = 'block';
    }
    c.previousSibling.style.display = 'none';
    // c.id = croppedImg;
    var ctx = c.getContext('2d');
    var imgData = ctx.getImageData(0, 0, c.width, c.height);
    var image = cropperImageInitCanvas;
    image.width = c.width;
    image.height = c.height;
    var ctx = image.getContext('2d');
    ctx.putImageData(imgData, 0, 0);

    cropper = new Cropper(image, {
      aspectRatio: 16 / 9,
      viewMode: 4,
      preview: '.img-preview',
      crop: function (event) {
        cropImageButton.style.display = 'block';
      }
    });

  } function image_crop() {
    if (cropperImageInitCanvas.cropper) {
      var cropcanvas = cropperImageInitCanvas.cropper.getCroppedCanvas({
        width: 250, height: 250
      });
      // document.getElementById('cropImages').appendChild(cropcanvas);
      var ctx = cropcanvas.getContext('2d');
      var imgData = ctx.getImageData(0, 0, cropcanvas.width, cropcanvas.height);
      // var image = document.getElementById(c);
      c.width = cropcanvas.width;
      c.height = cropcanvas.height;
      var ctx = c.getContext('2d');
      ctx.putImageData(imgData, 0, 0);
      cropperImageInitCanvas.cropper.destroy();
      cropperImageInitCanvas.width = 0;
      cropperImageInitCanvas.height = 0;
      cropImageButton.style.display = 'none';
      var allCloseButtons = document.querySelectorAll('.singleImageCanvasCloseBtn');
      for (let element of allCloseButtons) {
        element.style.display = 'block';
      }
      urlConversion();
    } else {
      alert('Please select any Image you want to crop');
    }
  }
  cropImageButton.addEventListener("click", function () {
    image_crop();
  });
  // Image Close/Remove
  function removeSingleCanvas(selector) {
    selector.parentNode.remove();
    urlConversion();
  }

  function urlConversion() {
    var allImageCanvas = document.querySelectorAll('.singleImageCanvas');
    var convertedUrl = '';
    canvasLength = allImageCanvas.length;
    for (let element of allImageCanvas) {
      convertedUrl += element.toDataURL('image/jpeg');
      convertedUrl += 'img_url';
    }
    document.getElementById('post_img_data').value = convertedUrl;
  }
</script>
<script>
  function validatePostMedia(files) {

    $('#imageValidate').empty();
    let err = 0;
    let ResponseTxt = '';
    if (files.length > 10) {
      err += 1;
      ResponseTxt += '<p> You can select maximum 10 files. </p>';
    }
    $(files).each(function (index, file) {
      if (file.size > 1048576) {
        err += 1;
        ResponseTxt += 'File : ' + file.name + ' is greater than 1MB';
      }
    });

    if (err > 0) {
      $('#imageValidate').html(ResponseTxt);
      return false;
    }
    return true;

  }
</script> --}}